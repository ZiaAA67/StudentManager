{% extends "layout/base.html" %}

{%block title%} Quản Lý Học Sinh {%endblock%}

{%block link_css%}
<link href="{{url_for('static', filename='css/student_management.css')}}" rel="stylesheet">
<link href="{{url_for('static', filename='css/darkmode.css')}}" rel="stylesheet">
{%endblock%}

{%block content%}
<button id="theme-switch">
    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#e8eaed">
        <path d="M480-120q-150 0-255-105T120-480q0-150 105-255t255-105q14 0 27.5 1t26.5 3q-41 29-65.5 75.5T444-660q0 90 63 153t153 63q55 0 101-24.5t75-65.5q2 13 3 26.5t1 27.5q0 150-105 255T480-120Z"/>
    </svg>
    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#e8eaed">
        <path d="M480-280q-83 0-141.5-58.5T280-480q0-83 58.5-141.5T480-680q83 0 141.5 58.5T680-480q0 83-58.5 141.5T480-280ZM200-440H40v-80h160v80Zm720 0H760v-80h160v80ZM440-760v-160h80v160h-80Zm0 720v-160h80v160h-80ZM256-650l-101-97 57-59 96 100-52 56Zm492 496-97-101 53-55 101 97-57 59Zm-98-550 97-101 59 57-100 96-56-52ZM154-212l101-97 55 53-97 101-59-57Z"/>
    </svg>
</button>
<div class="card ">
        <div class="d-flex justify-content-center">
            <h1 class="text-center mt-2" style="font-weight:bold">THÔNG TIN HỌC SINH</h1>
        </div>
        <div class="d-flex justify-content-center align-items-center">
        <form style="width:35rem" id="student-form" method="POST">
            <div class="form-floating mb-3">
                <input type="text" class="form-control shadow-sm" id="name" placeholder="Họ tên" name="name"
                       required>
                <label for="name">Họ tên</label>
            </div>

            <label>* Giới tính</label>
            <div class="fieldset mt-1 mb-3">
                <div class="gender">
                    <input type="radio" id="male" name="gender" value="Male" checked required>
                    <label for="male">Nam</label>
                    <input type="radio" id="female" name="gender" value="Female" required>
                    <label for="female">Nữ</label>
                </div>
            </div>

            <label for="date_of_birth">* Ngày sinh</label>
            <div class="mt-1 mb-3">
                <input class="fieldset" type="date" id="date_of_birth" name="date_of_birth" required>
            </div>

            <div class="mb-3">
                <textarea class="form-control shadow-sm" id="address" name="address" rows="3" placeholder="Địa chỉ" required></textarea>
            </div>


            <div class="form-floating mb-3 ">
                <input type="tel" class="form-control shadow-sm" id="phone" placeholder="Số điện thoại" name="phone"
                       required>
                <label for="phone">Số điện thoại</label>
            </div>

            <div class="form-floating mb-3 ">
                <input type="email" class="form-control shadow-sm" id="email" placeholder="Email" name="email"
                       required>
                <label for="email">Email</label>
            </div>

            <label for="grade">* Khối lớp</label>
            <div class="mt-1 mb-3">
                <select class="fieldset" id="grade" name="grade" required>
                    <option value="">Chọn khối</option>
                    {% for grade_value, grade_display in grades %}
                    <option value="{{ grade_value }}">{{ grade_display }}</option>
                    {% endfor %}
                </select>
            </div>

            {% with messages = get_flashed_messages(with_categories=True) %}
            {% if messages %}
            <div id="flash-messages" style="display:none;">
                {% for category, message in messages %}
                <div class="alert alert-{{category}}">
                    {{ message }}
                </div>
                {% endfor %}
            </div>
            {% endif %}
            {% endwith %}

            <!-- Register Button -->
            <div class="d-flex justify-content-center mt-5">
                <input type="submit" value="Lưu thông tin" class="btn btn-red shadow">
            </div>

            <!--                <div class="alert alert-danger" id="error-message" style="display: none;">Please check the form-->
            <!--                    inputs.-->
            <!--                </div>-->

        </form>
            </div>
    <div class="mt-5">
    <div class="separator">
        <span><h2>DANH SÁCH HỌC SINH</h2></span>
    </div>
    <form class="d-flex" style="align-items:center;margin-left:auto;width:fit-content">
        <input class="fieldset" style="width:300px;margin-right:5px" name="q" type="text"
               placeholder="Tìm kiếm học sinh...">
        <button class="btn btn-red mb-3" style="background-color:dodgerblue;width:80px; height:50px" type="submit">
            Tìm
        </button>
    </form>
</div>
<table>
    <thead>
    <tr>
        <th>STT</th>
        <th>Họ tên</th>
        <th>Giới tính</th>
        <th>Ngày sinh</th>
        <th>Khối</th>
        <th>Tuỳ chọn</th>
    </tr>
    </thead>
    <tbody>
    {% for student in students %}
    <tr>
        <td>{{ loop.index + ((pagination.page - 1) * pagination.per_page) }}</td>
        <td>{{ student.user_information.full_name }}</td>
        <td>{{ 'Nam' if student.user_information.gender else 'Nữ' }}</td>
        <td>{{ student.user_information.birth.strftime('%d-%m-%Y') }}</td>
        <td>{{ student.grade }}</td>
        <td width="200" class="text-center">
            <button class="btn btn-success mt-1 mb-1 me-2">
                <a style="text-decoration: none; color: white" href="/students/{{student.id}}">Chi tiết</a>
            </button>
            <button class="btn btn-danger mt-1 mb-1" onclick="deleteStudent({{student.id}})">Xoá</button>
        </td>
    </tr>
    {% endfor %}
    </tbody>
</table>

<nav aria-label="Pagination" class="mt-3">
    <ul class="pagination justify-content-center">
         <li class="page-item">
            <a class="page-link" href="?page=1">First</a>
        </li>

        {% if pagination.has_prev %}
        <li class="page-item">
            <a class="page-link" href="?page={{ pagination.prev_num }}{% if q %}&q={{ q }}{% endif %}" aria-label="Previous">
                <span aria-hidden="true">Previous</span>
            </a>
        </li>
        {% else %}
        <li class="page-item disabled">
            <span class="page-link">Previous</span>
        </li>
        {% endif %}

        {% for page_num in range(start_page, end_page + 1) %}
        <li class="page-item {% if page_num == pagination.page %}active{% endif %}">
            <a class="page-link" href="?page={{ page_num }}{% if q %}&q={{ q }}{% endif %}">{{ page_num }}</a>
        </li>
        {% endfor %}

        {% if pagination.has_next %}
        <li class="page-item">
            <a class="page-link" href="?page={{ pagination.next_num }}{% if q %}&q={{ q }}{% endif %}" aria-label="Next">
                <span aria-hidden="true">Next</span>
            </a>
        </li>
        {% else %}
        <li class="page-item disabled">
            <span class="page-link">Next</span>
        </li>
        {% endif %}

        <li class="page-item">
            <a class="page-link" href="?page={{total_pages}}">Last</a>
        </li>
    </ul>
</nav>
  </div>

{%endblock%}


{%block link_js%}
<script src="{{url_for('static', filename='js/students.js')}}"></script>
<script src="{{url_for('static', filename='js/darkmode.js')}}"></script>
{%endblock%}